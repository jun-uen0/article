# OAuth

参考書

「雰囲気でOAuth2.0を使っているエンジニアがOAuth2.0を整理して、手を動かしながら学べる本」

### OAuthって

よくGoogleとかGitHubとかの認証画面がでてくる。あれ。

「認証を許可しますか」とか「アプリケーションに以下の項目のアクセスを許可します」とかそんな感じのもの。

### OAuth認証にはサードパーティアプリにIDとパスワードを教えなくてもいい。

というか、教えてはならない。もしIDとパスワードがあればそのアプリはなんでもできてしまう。オリジナルユーザー同等の権限があることになる。

# OAuth のトークン

---

### リソースオーナー

リソースを保持するアプリを使用するユーザーのこと。人。

### クライアント

リソースを保持するアプリにアクセスしようとするアプリ。連携アプリみたいな。

### リソースサーバー

リソースを保持するアプリのサーバー。

### 認可サーバー

- リソースオーナーの認証 (ログインではなく、リソースオーナーであることを確かめるだけ)
- リソースオーナーの同意を得る
- **アクセストークンの発行**

### アクセストークン

- 操作の許可
    - 誰が
    - どのリソースに
    - どのような操作を
- トークンの有効期限

> クライアントからリソースサーバーに対する全てのアクセスにアクセストークンが含まれている必要がある。
>

OAuthのアクセストークンはBearerで、Bearerはアクセストークンの送信元を確認しない。アクセストークンに紐づけれられた権限でリソースにアクセスすることができる。

### スコープ

権限範囲のこと。ダウンロードするだけなのか、フォロワーリストを取得するのか、レポジトリの情報を取得するのか、など。

クライアントから認可サーバーへのリクエスト時に行う

### 有効期限

アクセストークンの有効期限。

だいたい24時間。

### リフレッシュトークン

クライアントから認可サーバーに対するアクセストークンの再発行の要求時に利用。

標準仕様では必須とされていないのでAPIによっては発行されないこともある。

リフレッシュトークンにも有効期限があるがアクセストークンに比べて長い。

### 認可コード

ユーザーがクライアントへの権限委譲に同意した証

この認可コードを元に認可サーバーに対してアクセストークンを要求する

認可コードは一度しか使用することができない。

ブラウザを介してクライアントに届くため、セキュアではない。10分以内の短い有効期限が推奨されている。

# OAuthのエンドポイント

---

OAuthには主に3つのエンドポイントがあり、認可コードグラントに使用される。

認可サーバーが提供するエンドポイント

- 認可エンドポイント
- トークンエンドポイント

クライアントが提供するエンドポイント

- リダイレクトエンドポイント

### 認可エンドポイント

認可コードを発行するエンドポイント。認可サーバーが提供。

クライアントが真っ先にアクセスするエンドポイント (まだアクセス権を持っていない場合)

リソースに対するユーザー名とパスワードの入力で認証を行う。

認証が完了するとリソースオーナー (ユーザー) にクライアントへのアクセス権委譲の同意を求める。

同意が完了すると認可コードがリダイレクトエンドポイントに送られる。

### トークンエンドポイント

アクセストークンを取得するためのエンドポイント。認可サーバーが提供。

Basic認証でクライアントのアイデンティティが確認される。

Basic認証で必要なもの

- クライアントID
- クライアントシークレット

クライアントを認可サーバーに事前登録する際に発行される

### リダイレクトエンドポイント
